
Q3_p=65358582236399098140383852530576291366163143046961680710706395821174671515157
Q3_g=18897172015605387895108229785692294238197575884158182212205468678506383277799
Q3_n=8
Q3_known_pt=78 # K_AES
Q3_known_cts=[100628902399338964202200242941450411720717377931230557189110959279361311229001, 79923898701216899144853725027432650161301782570164486779243637889104029662368, 55228370606105758625095625775030639601831950673587675541654733964047812795678, 101749686178974500409803681273998979904868247884559953317310940827332622293981]
Q3_ct_aes=b'}\x99B\xf2"\x93\xeb\x1c\x88\x07H\xdc\xfa\xcaF\x8b\xbd\x1b\xd60\xe2Js\xbe\xb8\xb3\x1f'
Q3_nonce=b'`\xf2\x81\xdc\xf54\x03\xc0L\x96\x1e\xe3\x1a\x8e\x18\xa7'
Q3_tag=b'\xf9\xc1\xc4\xb3\xf4\xa4\xa5\x94v\xae\x17fp;\xba\xb6'
Q3_cts=[96197102776248135901403305067813685344069468256276047015502497634632857912810, 77667109048112706782195925279795318351880240870644084053874691247961825223105, 12064654708520710960329113824682425497406352673600704569596082058654978271218, 93440727251381127803648135663020436094433120127379861031712136174489086217389, 32727532644989767859830260394504234662984171617644357023311556289923682538029, 15392332867374215159001673690046802135587477332931416040938665140215477138093, 29907790089591110441401771823677786272181581009676721542200867058383829538517, 52356874688257175008967891133370938276571912148854925194144705185297183058481, 73714720713412445101447311528996932868473982422394976315254713776435329370159, 15055160476138103388637948342861460643264774334874917561144873215161106366112, 19827501013037451086596079497838987338777071339662937515878573672408631427481, 96163425751499124192672726649945864147643525670376150290509811822377979631091, 13059294653081968826150876185227741063398313547711584070131220642507442670172, 66344600472103300424832817985721525715721964668388176192276464860952097078505, 104623105384546245241084543428567906865734286133677305174079729880246386132243, 90740049162353765141336069545661189076267124782320876426751933700701796995699, 80945284819715270382685849505157823019110383521618469514837004767719075226179, 29779696136686304469687567199099790325749241292180334522057706853868606527604, 27536670256195309996488509375598267501578656448334352088160823394907028116480, 25177323154280731320242478819664182415209867298191264118037595837617003515572, 62188801466068834690029579188653687659457401409284502464685792602490839612930, 24010454619753894690034722118510973378141567536589062782109537961705154668040, 103011005752354228076742889223056094394682853648397061890667685831482373849291, 1185968516120312256857268931717109462416408298098070168292866412299923478687, 101608186065559436658614526765114905965812149385330396902526576373594163797833, 39643340389313732274336763253367505648838192382007505918180229245530426955268, 93167662249895420333984498140443624984775160500624771159013032470637564935485, 108220812459016356545536893066306334838725443468085086838579439525462439350749, 39870999586054738513591704966111631794267039707988294637565820760403763177892, 42838030574050232817029872004777229167232533144501097584137515134662003600481, 31318989410779206216673589280247334820596842367344318701943146535166380606434, 45361671403276491943023305359448174567062945716604254631808901090335540127136, 89674657257257891063538107152818484295420508042870324939751211869543484129745, 49801530231399779567342205111372203137641899716877185834534957635842789623195, 60322122513140911926176903156184315543947429416639687942786406168132058130517, 109817572878339768668063160993742262638913986205267404467328488178073436627281, 105857625380392275712190756387852081573250194169879285939036317643716337719258, 78434558134356183159316183447878972062251897111273139464123589615196561426339, 24705602650257596772907088676736343275311629323569585764126640373819478805109, 78598610112777540631043648044088133555837136160092531452470643128981160471432, 34810412085547216823188668371772975514447144263796919879535743879459333784599, 39485754109910699060104022589168044091953741572670281110674290882893832707880, 59714446287507601674355954065411053820716433860196788991679751779565756285974, 99961449526236873448125535271105561020331125903066936490257227022062538248120, 84143811976639777869465677640926952328126512126672770219830920370179826122840, 15165015960856288907565321296492342196948362126511670780972043449934275951281, 106071682104312228085808956351118582671190195776344308783042283416785673022747, 81198721787710812579371336963402807984571548464929303699319156450622699991162, 93584223190043132856505563365679513683649431894859485930077357411364720739650, 47707943529562416640277488573095953620694446053386644606497767829673319671245, 25235493954081720865977261964409446085647606549818412773661242209120621202694, 23980352938575899705879814951035745861711316799703673998790230025876681171867, 67816996361429374428600372046424237601502438176038443622226835428214355354766, 69911811562417475947257194218037267931991637495653559632152693474227090821944, 111375141354197162442143595818530277517171506604502733564654945294891897464265, 104603779239595768754994945958533165271514223802227262280678668513349196885313, 28904844338758007888673631390648433831909229645467884006447051993271307479128, 67106295897740038164136384360079374155223660912442632592978544111829115741798, 81307631160052534725295539283062388598650928006808019989018102697175545637442, 28103902767838524732345277162959872638157732115355044993066464635915067106452, 36849151454636572648650014600128624986271190913520007829250207824745853781148, 21335057328444140629550325284370567865745971253019370552070783069851480946421, 47880417238519502579903303597306685938604173385332850528805756498984780037190]


def modP(n):
    return n % Q3_p

def pow_modP(x, k):
    return modP(x ** k)

def get_bits(n, pad=0):
    s = bin(n)[2:]
    bits = [int(c) for c in s]
    if pad:
        bits = [0] * pad + bits
    return bits

def get_bit(num, b):
    bits = get_bits(num, pad=256)
    if b >= len(bits):
        return 0
    return bits[b]


n = Q3_n
g = Q3_g

g0 = 1
g1 = g                           # order 4
g2 = modP(g * g)              # order 2
g3 = modP(g * g * g)       # order 4

Kxors = [0, 1, 2, 3]  # [00, 01, 10, 11]

print(bin(g1)[2:][n:n+2])
print(bin(g2)[2:][n:n+2])
print(bin(g3)[2:][n:n+2])

K_aes_known_bits = get_bits(Q3_known_pt, pad=8)


# # FIND K_EXP

# bin_str_mj = bin(Q3_known_pt)[2:]

# for every g^Kexp possibility
for Kexp in [0, 1, 2, 3]:
    # for every Kxor two-bit possibilities
    K0_ctr = 0
    K1_ctr = 0
    for j in range(4):
        L = len(K_aes_known_bits)
        mj = K_aes_known_bits[L - 2*j - 2 : L - 2*j]
        mj = 2^mj[0] + mj[1] # int version
        Kxor = Q3_known_cts[j] ^ pow_modP(g, Kexp + mj + 2*(j+1))
        K0 = get_bit(Kxor, n)
        K1 = get_bit(Kxor, n+1)
        K0_ctr += K0
        K1_ctr += K1
    
    print("if Kexp is ", Kexp, " counters are ",K0_ctr, K1_ctr)
    if (K0_ctr == 0 or K0_ctr == 4) and (K0_ctr == 0 or K0_ctr == 4):
        print("if Kexp is ", Kexp, " works")
        


#     for Kxor in Kxors:
#         #multiply g^mj * g^Kexp XOR with Kxor possibility
#         mj = bin_str_mj[]
#         c = 
#         check to see if this choice matches with known_cts at the two-bit position


# first XOR with Kxor two-bit position 
# then multiply by Kexp inverse
# then multiply to correct for 2(j+1)


# def decrypt(Q3_ct_aes, Q3_nonce, Q3_tag, Q3_cts):